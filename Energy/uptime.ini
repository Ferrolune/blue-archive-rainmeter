; A display for ystem uptime.
[Rainmeter]
Update=50
DefaultUpdateDivider=-1
AccurateText=1
SkinWidth=(355*#GScale#)
SkinHeight=(140*#GScale#)
ContextTitle=Change Maximum Value
ContextAction=[!SetOption ValueChangeText Text "Max Energy Value:"][!UpdateMeter ValueChangeText][!HideMeter HoverHitbox][!ShowMeter ValueChangeText][!ShowMeter InputBubble][!CommandMeasure InputTable "ExecuteBatch 1"]
ContextTitle2=Change Decay Rate
ContextAction2=[!SetOption ValueChangeText Text "Decay Rate (per min.):"][!UpdateMeter ValueChangeText][!HideMeter HoverHitbox][!ShowMeter ValueChangeText][!ShowMeter InputBubble][!CommandMeasure InputTable "ExecuteBatch 2"]

[Metadata]
Name=Blue Archive - Energy
Author=Xenon257R
Information=A Blue Archive themed PC uptime tracker. | | Drains 1 Energy point every [x] minutes.
Version=1.0.0
License=Creative Commons Attribution - Non - Commercial - Share Alike 3.0

[Variables]
@includeConfig=#@#config.inc
MaximumEnergy=210
DecayRate=0.2
UpdateDividerValue=1200

[DebugContainer]
Meter=Shape
Shape=Rectangle 0,0,(355*#GScale#),(140*#Gscale#) | #Debug#

[EnergyContainerShadow]
Meter=Shape
Shape=Rectangle 0,0,(240*#GScale#),(65*#GScale#),#Edgeround# | FillColor #ShadowColor# | Skew #FullSkew# | StrokeWidth 0
X=(#SX#+(55*#GScale#))
Y=(#SY#+(5*#GScale#))

[EnergyContainer]
Meter=Shape
Shape=Rectangle 0,0,(240*#GScale#),(65*#GScale#),#Edgeround# | FillColor #TrayColor# | Skew #FullSkew# | StrokeWidth 0
X=(55*#GScale#)
Y=(5*#GScale#)

[EnergyIcon]
Meter=Image
H=(45*#GScale#)
W=(45*#GScale#)
X=(65*#GScale#)
Y=(15*#GScale#)
ImageName=#@#assets\Common_Icon_Stamina.png
PreserveAspectRatio=1
DynamicVariables=1

[MeasureCurrentTime]
Measure=Time
UpdateDivider=#UpdateDividerValue#

[MeasureUserLoginTime]
Measure=Plugin
Plugin=SysInfo
SysInfoType=USER_LOGONTIME

[EnergySecondsUptime]
Measure=UpTime
SecondsValue=([MeasureCurrentTime:] - [MeasureUserLoginTime:])
Format="%3!i!h, %2!i!m since login."
DynamicVariables=1
UpdateDivider=#UpdateDividerValue#

[EnergyCalc]
Measure=Calc
Formula=Clamp((#MaximumEnergy# - ([EnergySecondsUptime:] * (#DecayRate# / 60))), 0, #MaximumEnergy#)
DynamicVariables=1
UpdateDivider=#UpdateDividerValue#

[MeterEnergyPercent]
Meter=String
MeasureName=EnergyCalc
FontFace=#PrimaryFont#
FontColor=#TextColor#
FontWeight=700
StringAlign=LeftCenter
W=(200*#GScale#)
X=(115*#GScale#)
Y=(37.5*#GScale#)
FontSize=(22*#GScale#)
Text=%1/#MaximumEnergy#
AntiAlias=1
DynamicVariables=1
UpdateDivider=#UpdateDividerValue#

[UpTimeInfoBubble]
Meter=Shape
Group=UpTimeInfoGroup
Shape=Line (25*#GScale#),(25*#GScale#),(330*#GScale#),(25*#GScale#) | StrokeWidth (50*#GScale#) | StrokeColor #PopUpColor# | StrokeStartCap #PopUpCap# | StrokeEndCap #PopUpCap#
Shape2=Path Pointer | Fill Color #PopUpColor# | StrokeWidth 0
Shape3=Rectangle 0,0,(355*#GScale#),(50*#GScale#),(25*#GScale#) | Fill Color #PopUpColor# | StrokeWidth 0
Shape4=Combine Shape2 | Exclude Shape3
X=0
Y=(90*#GScale#)
Hidden=1
Pointer=(150*#GScale#),(15*#GScale#) | LineTo (177.5*#GScale#),(-10*#GScale#) | LineTo (205*#GScale#),(15*#GScale#) | ClosePath 1

[UpTimeBinInfoText]
Meter=String
MeterStyle=PopUpStyle
Group=UpTimeInfoGroup
MeasureName=EnergySecondsUptime
Text=%1
X=(177.5*#GScale#)
Y=(115*#GScale#)
W=(330*#GScale#)
StringAlign=CenterCenter
InlineSetting=Color | #HighlightColor#
InlinePattern=(\d)
UpdateDivider=#UpdateDividerValue#

[InputTable]
Measure=Plugin
Plugin=InputText
FontFace=Lucida Console
FontSize=(20*#GScale#)
StringAlign=Left
InputNumber=1
InputLimit=3
W=(80*#GScale#)
H=(30*#GScale#)
X=(250*#GScale#)
Y=(100*#GScale#)
Command1=[!WriteKeyValue Variables MaximumEnergy $UserInput$][!Refresh]
Command2=[!WriteKeyValue Variables DecayRate $UserInput$][!Refresh]
OnDismissAction=[!ShowMeter HoverHitbox][!HideMeter InputBubble][!HideMeter ValueChangeText]

[InputBubble]
Meter=Shape
MeterGroup=EditGroup
Shape=Line (25*#GScale#),(25*#GScale#),(330*#GScale#),(25*#GScale#) | StrokeWidth (50*#GScale#) | StrokeColor #PopUpColor# | StrokeStartCap #PopUpCap# | StrokeEndCap #PopUpCap#
Shape2=Path Pointer | Fill Color #PopUpColor# | StrokeWidth 0
Shape3=Rectangle 0,0,(355*#GScale#),(50*#GScale#),(25*#GScale#) | Fill Color #PopUpColor# | StrokeWidth 0
Shape4=Combine Shape2 | Exclude Shape3
X=0
Y=(90*#GScale#)
Hidden=1
Pointer=(150*#GScale#),(15*#GScale#) | LineTo (177.5*#GScale#),(-10*#GScale#) | LineTo (205*#GScale#),(15*#GScale#) | ClosePath 1

[ValueChangeText]
Meter=String
MeterGroup=EditGroup
MeterStyle=PopUpStyle
StringAlign=CenterCenter
FontSize=(18*#GScale#)
Text=Max Value
X=(130*#GScale#)
Y=(115*#GScale#)
W=(225*#GScale#)
AntiAlias=1

[HoverHitbox]
Meter=Shape
Shape=Rectangle 0,0,(240*#GScale#),(65*#GScale#) | #Hitbox#
X=(55*#GScale#)
Y=(5*#GScale#)
MouseOverAction=[!ShowMeterGroup "UpTimeInfoGroup"]
MouseLeaveAction=[!HideMeterGroup "UpTimeInfoGroup"]
DynamicVariables=1
